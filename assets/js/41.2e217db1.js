(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{621:function(t,e,r){"use strict";r.r(e);var a=r(17),s=Object(a.a)({},(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h2",{attrs:{id:"核心概念"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#核心概念"}},[t._v("#")]),t._v(" 核心概念")]),t._v(" "),r("ul",[r("li",[t._v("Authentication：认证，验证当前访问系统的是不是本系统的用户，并且要确认具体是哪个用户")]),t._v(" "),r("li",[t._v("Authorization：授权，经过认证后判断当前用户是否有权限进行某个操作")])]),t._v(" "),r("h2",{attrs:{id:"基本原理"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#基本原理"}},[t._v("#")]),t._v(" 基本原理")]),t._v(" "),r("h3",{attrs:{id:"过滤器介绍"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#过滤器介绍"}},[t._v("#")]),t._v(" 过滤器介绍")]),t._v(" "),r("blockquote",[r("p",[t._v("Spring Security 本质是一个"),r("strong",[t._v("过滤器链")])])]),t._v(" "),r("h4",{attrs:{id:"usernamepasswordauthenticationfilter"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#usernamepasswordauthenticationfilter"}},[t._v("#")]),t._v(" UsernamePasswordAuthenticationFilter")]),t._v(" "),r("p",[t._v("简单来说就是负责认证。它会过滤登录的URL，获取前台输入的用户名，密码并封装成"),r("code",[t._v("UsernamePasswordAuthenticationToken")]),t._v("对象，之后再通过"),r("code",[t._v("AuthenticationManager.authenticate()")]),t._v("进行校验")]),t._v(" "),r("h4",{attrs:{id:"exceptiontranslationfilter"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#exceptiontranslationfilter"}},[t._v("#")]),t._v(" ExceptionTranslationFilter")]),t._v(" "),r("p",[t._v("处理过滤器链中抛出的任何"),r("code",[t._v("AccessDeniedException 和 AuthenticationException")])]),t._v(" "),r("h4",{attrs:{id:"filtersecurityinterceptor"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#filtersecurityinterceptor"}},[t._v("#")]),t._v(" FilterSecurityInterceptor")]),t._v(" "),r("p",[t._v("简单来说就是负责授权。它是方法级的权限过滤器，基本位于过滤器链"),r("strong",[t._v("最底部")])]),t._v(" "),r("h3",{attrs:{id:"过滤器链的加载流程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#过滤器链的加载流程"}},[t._v("#")]),t._v(" 过滤器链的加载流程")]),t._v(" "),r("p",[t._v("DelegatingFilterProxy -> FilterChainProxy -> 通过 getFilters 加载过滤器")]),t._v(" "),r("h3",{attrs:{id:"核心接口"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#核心接口"}},[t._v("#")]),t._v(" 核心接口")]),t._v(" "),r("h4",{attrs:{id:"userdetailsservice"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#userdetailsservice"}},[t._v("#")]),t._v(" UserDetailsService")]),t._v(" "),r("p",[t._v("通过该接口自定义用户信息查询逻辑，一般都是查询数据库，返回对象需要是"),r("code",[t._v("UserDetails")]),t._v("类型")]),t._v(" "),r("h4",{attrs:{id:"passwordencoder"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#passwordencoder"}},[t._v("#")]),t._v(" PasswordEncoder")]),t._v(" "),r("p",[t._v("数据加密接口，用于返回用户对象密码的加密")]),t._v(" "),r("h3",{attrs:{id:"认证授权注解"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#认证授权注解"}},[t._v("#")]),t._v(" 认证授权注解")]),t._v(" "),r("p",[t._v("通过"),r("code",[t._v("@EnableGlobalMethodSecurity")]),t._v("注解开启认证授权注解")]),t._v(" "),r("ul",[r("li",[t._v("@Secured：判断是否拥有指定角色，通过"),r("code",[t._v("securedEnabled = true")]),t._v("启用")]),t._v(" "),r("li",[t._v("@PreAuthorize：方法执行前进行权限验证，通过"),r("code",[t._v("prePostEnabled = true")]),t._v("启用")]),t._v(" "),r("li",[t._v("@PostAuthorize：方法执行后进行权限验证，通过"),r("code",[t._v("prePostEnabled = true")]),t._v("启用。该注解不经常使用")]),t._v(" "),r("li",[t._v("@PreFilter：进入方法前对"),r("strong",[t._v("请求")]),t._v("数据进行过滤")]),t._v(" "),r("li",[t._v("@PostFilter：权限验证后对"),r("strong",[t._v("响应")]),t._v("数据进行过滤")])]),t._v(" "),r("h3",{attrs:{id:"基础的认证流程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#基础的认证流程"}},[t._v("#")]),t._v(" 基础的认证流程")]),t._v(" "),r("p",[r("img",{attrs:{src:"http://qiniu.promisingyoung.cn/202205211501302.png",alt:""}})]),t._v(" "),r("h2",{attrs:{id:"自定义jwt认证"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#自定义jwt认证"}},[t._v("#")]),t._v(" 自定义JWT认证")]),t._v(" "),r("h3",{attrs:{id:"思路分析"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#思路分析"}},[t._v("#")]),t._v(" 思路分析")]),t._v(" "),r("p",[r("strong",[t._v("登录")])]),t._v(" "),r("ol",[r("li",[t._v("自定义登录接口\n"),r("ol",[r("li",[t._v("通过"),r("code",[t._v("AuthenticationManager")]),t._v("调用 authenticate 方法进行认证，认证成功生成JWT")]),t._v(" "),r("li",[t._v("将用户信息存入 redis 缓存中")])])]),t._v(" "),r("li",[t._v("实现"),r("code",[t._v("UserDetailsService")]),t._v("接口\n"),r("ol",[r("li",[t._v("重写"),r("code",[t._v("loadUserByUsername")]),t._v("方法，通过数据库查询用户信息，并返回 UserDetails 对象")])])])]),t._v(" "),r("p",[r("strong",[t._v("校验")])]),t._v(" "),r("ol",[r("li",[t._v("定义JWT认证过滤器\n"),r("ol",[r("li",[t._v("获取并解析 Token，获取用户信息")]),t._v(" "),r("li",[t._v("从 redis 缓存中获取详细的用户信息")]),t._v(" "),r("li",[t._v("存入 SecurityContextHolder")])])])]),t._v(" "),r("h2",{attrs:{id:"跨域问题"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#跨域问题"}},[t._v("#")]),t._v(" 跨域问题")]),t._v(" "),r("h3",{attrs:{id:"后端服务开启允许跨域请求"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#后端服务开启允许跨域请求"}},[t._v("#")]),t._v(" 后端服务开启允许跨域请求")]),t._v(" "),r("p",[t._v("通过重写"),r("code",[t._v("WebMvcConfigurer#addCorsMappings")]),t._v("方法可以开启跨域访问")]),t._v(" "),r("h3",{attrs:{id:"spring-security-开启允许跨域请求"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#spring-security-开启允许跨域请求"}},[t._v("#")]),t._v(" Spring Security 开启允许跨域请求")]),t._v(" "),r("p",[t._v("通过调用"),r("code",[t._v("httpSecurity.cors()")]),t._v("方法可以开启跨域访问")]),t._v(" "),r("h2",{attrs:{id:"自定义权限校验方法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#自定义权限校验方法"}},[t._v("#")]),t._v(" 自定义权限校验方法")]),t._v(" "),r("p",[t._v("**方法定义要求：**返回值需要为 boolean 类型")]),t._v(" "),r("p",[t._v("通过"),r("code",[t._v("SpEL表达式")]),t._v("进行方法调用，例如，"),r("code",[t._v("@PreAuthorize(\"@component('sys:perms:query')\")")])]),t._v(" "),r("h2",{attrs:{id:"csrf-概念"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#csrf-概念"}},[t._v("#")]),t._v(" CSRF 概念")])])}),[],!1,null,null,null);e.default=s.exports}}]);